---
- name: "Set up a Telegraf agent"
  hosts: all

  vars_files:
    - default.config.yml

  tasks:
    - name: "Gather packages facts"
      package_facts:
        manager: auto

    - name: "Include: tasks/install.yml"
      include_tasks: tasks/install.yml
      when: "'telegraf' not in ansible_facts.packages"

    - name: "Include: tasks/configure.yml"
      include_tasks: tasks/configure.yml

    - name: "Restart Telegraf"
      service:
        name: telegraf
        state: restarted
